<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <title>Simple Chat Room Demo</title>
</head>
<body>
	<p>PubSub over WebSockets using the WS3V Protocol</p>
	<p>Simple Chat Room Demo</p>
    <div id="rooms" style="width:100%; clear:both">
	loading rooms...
    </div>
	<script src="../../WS3V/websocket.js"></script>
    
    <!-- Debug Mode Requires the Following Styles and Scripts -->
    <link rel="stylesheet" href="../../WS3V/debug-assets/css/styles.css">
    <script src="../../WS3V/debug-assets/vkbeautify/vkbeautify.js"></script>
    <!-- End Debug Required -->
    
    <script>
	function getListing()
	{
		// make sure websocket is open and supports channels
		if(RESTfulAPI.SocketState == WS3VWebSocket.prototype.SocketStates.Open && RESTfulAPI.channels)
		{
			// this is how a request looks, it is based on async "promises", which states that eventually the request will return a value
			RESTfulAPI.Channels(
			{
				// if the request works
				callback: function(channels, meta)
				{
					createRooms(channels, meta);
				}
			});
		}
	};
	
	function leave(id)
	{
		document.getElementById(id + '_messages').innerHTML = "";
		document.getElementById(id + '_controls').innerHTML = "<input id=\"join\" onclick=\"joinroom('" + id + "')\" type=\"button\" value=\"Join Room\">";
	};
	
	function joinroom(id)
	{
		document.getElementById(id + '_controls').innerHTML = "<input required id=\"" + id + "_message\" size=\"32\" placeholder=\"message\"/><input id=\"add\" onclick=\"send('" + id + "')\" type=\"button\" value=\"Send\"><input id=\"add\" onclick=\"leave('" + id + "')\" type=\"button\" value=\"Leave Room\">";
	};
	
	function createRooms(channels, meta)
	{
		var html = '';
		
		for (var i=0; i < channels.length; i++)
			html = html + '<div style="width:33%; float:left;"><div><i>'+channels[i]+'</i></div><div><strong>'+meta[i][0]+'</strong></div><div>'+meta[i][1]+'</div><div id="R'+i+'_messages"></div><div id="R'+i+'_controls"><input id="join" onclick="joinroom(\'R'+i+'\')" type="button" value="Join Room"></div></div>';
        
		document.getElementById('rooms').innerHTML = html;
	}
		
	function websocket()
	{	
		// build the WS3V WebSocket
		RESTfulAPI = new WS3VWebSocket
		({ 
			Server: "127.0.0.1",
			Port: 8181,
			Action: "RPCAPI",
			DebugMode: true
		});
		
		
		
		RESTfulAPI.Connected = function()
		{
			getListing();
			console.log("connected");
		};
		
		RESTfulAPI.Disconnected = function()
		{
			console.log("good bye");
		};
		
		// start the connection
		RESTfulAPI.Connect();
	}
	
	websocket();
	
	</script>
    <p style="clear:both">&nbsp;</p>
    <div class="footer container pad-sides-40" style="clear:both">
        <div class="copy">WS3V is an open WebSocket protocol providing modern web standard solutions for RESTful APIs.</div>
        <div class="trademark"><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">WS3V</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://ws3v.org" property="cc:attributionName" rel="cc:attributionURL" target="_blank">Mike Olsen</a> is licensed under a <a target="_blank" rel="license" href="http://creativecommons.org/licenses/by/3.0/deed.en_US">Creative Commons Attribution 3.0 Unported License</a>.</div>
    </div>
</body>
</html>
